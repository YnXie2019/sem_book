---
title: "Composite Variables"
author: "Jon Lefcheck"
date: "November 15, 2018"
output: html_document
---

## 1.1 What is a Composite Variable?

Composite variables are another way, besides latent variables, to represent complex concepts in structural equation modeling. The most important distinction between the two is that, while latent variables give rise to measurable manifestations of an unobservable concept, compositive variables arise from the combined influence of other variables. This is best illustrated by an example composite variable:

![composite variable](https://raw.githubusercontent.com/jslefche/sem_book/master/img/composite_variable_composite.png)

Here the arrows are leading *into*, not out of, the composite variable $\eta$, indicating that the composite variable is made up of the influences of the three example variables. Note: in this and other presentations, the composite is denoted by a hexagon, but can sometimes be an oval as it is a form of a latent variable (as we shall see).

If the composite is *entirely* made up of the three influences, it can be said to have no error. An example might be the two levels of a treatment (present/absent) that lead into a single composite variable called 'Treatment.' In this case, there are no other levels of treatment because you, as the investigator, did not apply any. Thus the composite 'Treatment' captures the full universe of treatment possibilities given the data.

In other cases, the property might arise from the collective influence of variables but is not without error. For example, the idea of soil condition arises from different aspects of the soil: its pH, moisture, grain size, and so on. However, one might measure only some of these, and thus there remain other factors (nitrogen content) that might contribute to the notion of soil condition. In this case, the composite *would* have error and is therefore known as a *latent composite*.

The benefit of such an approach is that complicated ideas can be distilled into discrete *blocks* that are easier to present and discuss. For example, it is easier to talk about the effects of the experimental treatment on soil condition, rather than the effect of treatment 1 on soil moisture, the effect of treatment 1 on soil pH, the effect of treatment 1 on soil grain size, and so on.

In this way, the composite harkens back to the early meta-model, or broad conceptual relationships that inform the parameterization of the structural path model. In fact, in populating the meta-model, you may wish to consider those broad concepts as composites when fitting the model, rather than modeling all relationships among all observed variables.

Selecting among latent, latent composite, and composite variables comes down to the concept in question, the presumed direction of causality, and the nature of the indicators.

For the soil example, consider: is it that there is a common difference among soils driving variation in pH, moisture, etc.? Or is it that pH, moisture, etc. are all independent properties that combine to inform soil condition? If the goal is measure plant growth in potting soils from different manufacturers, then manufacturer might be the common source of variation and a latent variable more appropriate. If the observer is visiting different sites and measuring conditions that describe the soil in each place, then perhaps a composite variable is warranted.

Another way of thinking about this is whether the indicators are interchangeable. In other words, does soil pH tell us the same information as soil moisture? If so, then they might be indicators of the same latent phenomenon. If not, and they contain unique information, then they likely combine to form a composite variable.

Finally, do the indicators co-vary? If they are under common control of a latent variable, then changing one should alter all the others. If they are relatively independent--for example, one can change grain size without changing nutrient content--then causation likely flows into a composite (rather than out of a latent) variable.

Now that we have defined a composite variable, let's see how to make one!

## 1.2 Constructing a Composite Variable

Compared to latent variables, a composite variable is actually very easy: its simply the sum of its indicators, hence the term *composite*.

The way in which the indicators are summed depends on whether they are expected to have the same weight (a *fixed composite*) or different weights (a *statistical composite*). The former might be something like species relative abundances. The latter is what we will focus on here.

The weights for the composite are easily acquired as they are the values that maximize the explained variance in some response. We have done this before many times: we're talking about maximum-likelihood fitting.

In fact, statistical composites can be boiled down to the coefficients from a multiple regression. The ML fitting function chooses parameter estimates for each predictor that maximize the likelihood of obseving the response. Those values serve as the loadings for the indicators of the composite variable. The data for each indicator are multipled by their loading and summed to generate the factor scores for the composite variable, which is then used in the structural model.

Let's demonstrate using some random data:

```{r}
set.seed(4)

y <- rnorm(50)
x1 <- rnorm(50)
x2 <- x1 + runif(50)

# run multiple regression
model <- lm(y ~ x1 + x2)

# get loadings
beta_x1 <- summary(model)$coefficients[2, 1]
  
beta_x2 <-  summary(model)$coefficients[3, 1]

# compute factor scores
composite <- beta_x1 * x1 + beta_x2 * x2
```

These values can then used to predict the response:

```{r}
summary(lm(y ~ composite))
```

Note how the unstandardized coefficient is 1. This is because____________. Thus, the coefficient is only interpretable in standardized units.

Let's fit this composite model with *lavaan*:

```{r}
library(lavaan)

comp_formula1 <- '
composite <~ x1 + x2

y ~ composite
'

sem(comp_formula1, data.frame(y, x1, x2))
```

Ah! A warning! It seems the model is not identified, so *lavaan* does not automatically fix the first loading to be 1 (as in latent variables). We have to fix the coefficients manually.

As a first pass, let's fix the loadings of $x1$ and $x2$ to the values from the multiple regression:

```{r}
comp_formula2 <- '
composite <~ -0.831 * x1 + 0.675 * x2

y ~ composite
'

comp_model2 <- sem(comp_formula2, data.frame(y, x1, x2))

summary(comp_model2, standardize = T)
```

It seems *lavaan* has fixed the variance on the composite variable to 0 automatically. Moreover, the unstandardized coefficient is still 1 but the standardized coefficient is 0.238. 

An alternative is to set the first loading to 1. This helps with identifiability but if the true value is far from 1, it may lead to non-convergence. In this case, computing the loadings by hand using multiple regression is needed.


